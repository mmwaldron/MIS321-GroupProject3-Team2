<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bio-Isac | Digital Verification</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="./styles/main.css" />
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom border-success">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="index.html">
          <span class="logo-text">BIO-ISAC</span>
          <span class="logo-accent">.</span>
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active" href="index.html">Home</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Container -->
    <div class="container my-5">
      <!-- Tabs Navigation -->
      <ul class="nav nav-tabs mb-4 justify-content-center" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="login-tab"
            data-bs-toggle="tab"
            data-bs-target="#login-pane"
            type="button"
            role="tab"
            aria-controls="login-pane"
            aria-selected="true"
          >
            <i class="bi bi-box-arrow-in-right"></i> Login
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="verify-tab"
            data-bs-toggle="tab"
            data-bs-target="#verify-pane"
            type="button"
            role="tab"
            aria-controls="verify-pane"
            aria-selected="false"
          >
            <i class="bi bi-shield-check"></i> Get Verified
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content" id="mainTabContent">
        <!-- Login Tab -->
        <div
          class="tab-pane fade show active"
          id="login-pane"
          role="tabpanel"
          aria-labelledby="login-tab"
        >
          <div class="row justify-content-center">
            <div class="col-lg-8">
              <!-- QR Code Login -->
              <div class="card mb-4">
                <div class="card-body p-4">
                  <div class="text-center mb-3">
                    <i class="bi bi-qr-code-scan text-success" style="font-size: 2.5rem;"></i>
                    <h4 class="mt-2 mb-1 text-success">QR Code Login</h4>
                    <p class="text-muted mb-0">Login using your QR Passport code</p>
                  </div>
                  <div class="text-center">
                    <a href="qr-login.html" class="btn btn-success btn-lg">
                      <i class="bi bi-qr-code-scan"></i> Login with QR Code
                    </a>
                  </div>
                  <small class="text-muted d-block mt-3 text-center">
                    <i class="bi bi-info-circle"></i> You will receive your QR Passport after admin approval
                  </small>
                </div>
              </div>

              <!-- Admin Login -->
              <div class="card">
                <div class="card-body p-4">
                  <div class="text-center mb-3">
                    <i class="bi bi-shield-lock text-success" style="font-size: 2.5rem;"></i>
                    <h4 class="mt-2 mb-1 text-success">Admin Login</h4>
                    <p class="text-muted mb-0">Administrator access only</p>
                  </div>
                  <form id="adminLoginForm" onsubmit="adminLogin(event)">
                    <div class="mb-3">
                      <label class="form-label">Email</label>
                      <input
                        type="email"
                        class="form-control bg-dark text-light border-success"
                        id="adminEmail"
                        placeholder="admin@email.com"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Password</label>
                      <input
                        type="password"
                        class="form-control bg-dark text-light border-success"
                        id="adminPassword"
                        placeholder="Enter password"
                        required
                      />
                    </div>
                    <button type="submit" class="btn btn-success w-100">
                      <i class="bi bi-box-arrow-in-right"></i> Login as Admin
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Get Verified Tab -->
        <div
          class="tab-pane fade"
          id="verify-pane"
          role="tabpanel"
          aria-labelledby="verify-tab"
        >
          <!-- Verification Section -->
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card verification-card">
            <div class="card-body p-4">
              <div class="text-center mb-4">
                <div class="logo-icon mb-3">
                  <i class="bi bi-shield-check"></i>
                </div>
                <h1 class="h3 mb-2 text-success">Digital Verification</h1>
                <p class="text-muted">Complete verification to receive your BioTrust Passport</p>
              </div>

              <!-- Verification Steps -->
              <div id="verificationSteps" class="verification-steps">
                <!-- Step 1: Basic Info -->
                <div class="step active" id="step1">
                  <h5 class="step-title">
                    <span class="step-number">1</span>
                    Personal Information
                  </h5>
                  <form id="basicInfoForm">
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label class="form-label">First Name</label>
                        <input
                          type="text"
                          class="form-control bg-dark text-light border-success"
                          id="firstName"
                          required
                        />
                      </div>
                      <div class="col-md-6 mb-3">
                        <label class="form-label">Last Name</label>
                        <input
                          type="text"
                          class="form-control bg-dark text-light border-success"
                          id="lastName"
                          required
                        />
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Email</label>
                      <input
                        type="email"
                        class="form-control bg-dark text-light border-success"
                        id="email"
                        required
                      />
                    </div>
                    <button type="submit" class="btn btn-success w-100">
                      Continue <i class="bi bi-arrow-right"></i>
                    </button>
                  </form>
                </div>

                <!-- Step 2: Digital Credentials -->
                <div class="step" id="step2" style="display: none">
                  <h5 class="step-title">
                    <span class="step-number">2</span>
                    Digital Credentials
                  </h5>
                  <form id="credentialsForm">
                    <div class="mb-3">
                      <label class="form-label">Last 4 digits of your Social Security Number</label>
                      <input
                        type="text"
                        class="form-control bg-dark text-light border-success"
                        id="govId"
                        placeholder="Last 4 digits"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Verification Document (Optional: Must be a government issued ID)</label>
                      <input
                        type="file"
                        class="form-control bg-dark text-light border-success"
                        id="verificationDoc"
                        accept=".pdf,.jpg,.png"
                      />
                      <small class="text-muted">Upload ID or verification document</small>
                    </div>
                    <div class="mb-3">
                      <label class="form-label">Company Email Address (Optional: Must be a company email address)/label>
                      <input
                        type="email"
                        class="form-control bg-dark text-light border-success"
                        id="companyEmail"
                        placeholder="your.email@company.com"
                        required
                      />
                      <small class="text-muted">We'll send a verification code to this email</small>
                    </div>
                    <div class="d-flex gap-2">
                      <button type="button" class="btn btn-outline-secondary" onclick="goToStep(1)">
                        Back
                      </button>
                      <button type="submit" class="btn btn-success flex-grow-1">
                        Send Verification Code <i class="bi bi-arrow-right"></i>
                      </button>
                    </div>
                  </form>
                </div>

                <!-- Step 2.5: Email Verification Code -->
                <div class="step" id="step2_5" style="display: none">
                  <h5 class="step-title">
                    <span class="step-number">2.5</span>
                    Email Verification
                  </h5>
                  <div class="mb-4 text-center">
                    <i class="bi bi-envelope-check text-success" style="font-size: 3rem;"></i>
                    <p class="text-muted mt-3">We've sent a verification code to <strong id="emailDisplay"></strong></p>
                  </div>
                  <form id="emailVerificationForm">
                    <div class="mb-3">
                      <label class="form-label">Verification Code</label>
                      <input
                        type="text"
                        class="form-control bg-dark text-light border-success text-center"
                        id="emailVerificationCode"
                        maxlength="8"
                        placeholder="Enter code"
                        style="font-size: 1.25rem; letter-spacing: 0.25rem; font-family: 'Courier New', monospace;"
                        required
                      />
                      <small class="text-muted d-block mt-2 text-center">Code expires in 10 minutes</small>
                    </div>
                    <div class="mb-3">
                      <button
                        type="button"
                        class="btn btn-link text-success p-0"
                        id="resendEmailCode"
                      >
                        Resend Code
                      </button>
                    </div>
                    <div class="d-flex gap-2">
                      <button type="button" class="btn btn-outline-secondary" onclick="goToStep(2)">
                        Back
                      </button>
                      <button type="submit" class="btn btn-success flex-grow-1">
                        Verify Email <i class="bi bi-shield-check"></i>
                      </button>
                    </div>
                  </form>
                </div>

                <!-- Step 2.75: CAPTCHA Verification -->
                <div class="step" id="step2_75" style="display: none">
                  <h5 class="step-title">
                    <span class="step-number">2.75</span>
                    Security Verification
                  </h5>
                  <div class="mb-4 text-center">
                    <i class="bi bi-shield-lock text-success" style="font-size: 3rem;"></i>
                    <p class="text-muted mt-3">Please complete the security verification below</p>
                  </div>
                  <form id="captchaForm">
                    <div class="mb-4 d-flex justify-content-center">
                      <div id="captchaContainer"></div>
                    </div>
                    <div class="d-flex gap-2">
                      <button type="button" class="btn btn-outline-secondary" onclick="goToStep(2.5)">
                        Back
                      </button>
                      <button type="submit" class="btn btn-success flex-grow-1" id="captchaSubmitBtn" disabled>
                        Continue <i class="bi bi-arrow-right"></i>
                      </button>
                    </div>
                  </form>
                </div>

                <!-- Step 3: MFA -->
                <div class="step" id="step3" style="display: none">
                  <h5 class="step-title">
                    <span class="step-number">3</span>
                    Multi-Factor Authentication
                  </h5>
                  <div class="mfa-container">
                    <div class="mb-4 text-center">
                      <div class="mfa-code-display" id="mfaCode">----</div>
                      <p class="text-muted mt-2">Enter the code sent to your email</p>
                    </div>
                    <form id="mfaForm">
                      <div class="mb-3">
                        <label class="form-label">Verification Code</label>
                        <input
                          type="text"
                          class="form-control bg-dark text-light border-success text-center"
                          id="mfaInput"
                          maxlength="4"
                          placeholder="0000"
                          required
                        />
                      </div>
                      <div class="mb-3">
                        <button
                          type="button"
                          class="btn btn-link text-success p-0"
                          id="resendCode"
                        >
                          Resend Code
                        </button>
                      </div>
                      <div class="d-flex gap-2">
                        <button type="button" class="btn btn-outline-secondary" onclick="goToStep(2)">
                          Back
                        </button>
                        <button type="submit" class="btn btn-success flex-grow-1">
                          Verify <i class="bi bi-shield-check"></i>
                        </button>
                      </div>
                    </form>
                  </div>
                </div>

                <!-- Step 4: Processing -->
                <div class="step" id="step4" style="display: none">
                  <div class="text-center py-5">
                    <div class="processing-spinner mb-4">
                      <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Processing...</span>
                      </div>
                    </div>
                    <h5 class="mb-3">Processing Verification</h5>
                    <p class="text-muted">Running risk analysis and security checks...</p>
                    <div class="progress mt-4" style="height: 4px">
                      <div
                        class="progress-bar bg-success progress-bar-striped progress-bar-animated"
                        role="progressbar"
                        style="width: 0%"
                        id="progressBar"
                      ></div>
                    </div>
                  </div>
                </div>

                <!-- Step 5: Result -->
                <div class="step" id="step5" style="display: none">
                  <div class="text-center py-4">
                    <div class="result-icon mb-4" id="resultIcon"></div>
                    <h4 id="resultTitle" class="mb-3"></h4>
                    <p id="resultMessage" class="text-muted mb-4"></p>
                    <div id="resultActions"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Trust Score Display (after verification) -->
          <div class="card mt-4 trust-score-card" id="trustScoreCard" style="display: none">
            <div class="card-body">
              <h6 class="card-title">Your Trust Score</h6>
              <div class="trust-score-display">
                <div class="score-circle" id="scoreCircle">
                  <span id="trustScoreValue">0</span>
                </div>
                <div class="score-details">
                  <div class="score-tier" id="scoreTier">Tier 1</div>
                  <div class="score-access" id="scoreAccess">Basic Access</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
        </div>
      </div>
    </div>

    <!-- Alert Notifications -->
    <div class="alert-container" id="alertContainer"></div>

    <!-- Google reCAPTCHA v2 -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <!-- Bootstrap JS bundle -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- Custom JS -->
    <script src="./scripts/apiConfig.js"></script>
    <script src="./scripts/api.js"></script>
    <script src="./scripts/riskFilter.js"></script>
    <script src="./scripts/trustScore.js"></script>
    <script>
      // Check if user is logged in and redirect appropriately
      (function() {
        const userId = localStorage.getItem('currentUserId');
        const userClassification = localStorage.getItem('userClassification');
        
        if (userId) {
          // User is logged in, redirect based on classification
          if (userClassification === 'admin') {
            window.location.replace('admin.html');
          } else {
            window.location.replace('dashboard.html');
          }
        }
      })();
    </script>
    <script src="./scripts/verification.js"></script>
    <script src="./scripts/main.js"></script>
  </body>
</html>

